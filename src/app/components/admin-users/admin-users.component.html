<div class="admin-profile-container">
  <div class="page-header-section profile-header mb-4">
    <div class="header-content">
      <div class="medical-icon profile">
        <i class="fas fa-users-cog"></i>
      </div>
      <div class="header-text">
        <h1 class="main-title">Gestion des Utilisateurs</h1>
        <p class="subtitle">L'administrateur de l'application peut gérer des utilisateurs (coach et patients)</p>
      </div>
    </div>
  </div>

  <div class="profile-content">
    <div class="alert-container">
      <div *ngIf="errorMessage" class="alert-medical alert-danger">
        <div class="alert-content">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <span>{{ errorMessage }}</span>
        </div>
        <button type="button" class="alert-close" (click)="errorMessage = ''">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div *ngIf="successMessage" class="alert-medical alert-success">
        <div class="alert-content">
          <i class="fas fa-check-circle me-2"></i>
          <span>{{ successMessage }}</span>
        </div>
        <button type="button" class="alert-close" (click)="successMessage = ''">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <div class="card-medical mb-5">
      <div class="card-header-medical">
        <h5 class="card-title">
          <i class="fas fa-users me-2"></i>Liste des Utilisateurs
        </h5>
        <div class="toolbar">
          <button class="btn btn-primary" (click)="addUser()">
            + Ajouter un utilisateur
          </button>
        </div>
        <div class="filters-section">
          <input
            type="text"
            placeholder="Rechercher par nom, prénom ou email..."
            [(ngModel)]="searchQuery"
            (input)="onSearchChange()"
            class="form-control-medical"
          />
          <select [(ngModel)]="filterRole" (change)="onFilterChange()" class="form-control-medical">
            <option value="">Tous les rôles</option>
            <option value="COACH">Coach</option>
            <option value="USER">Patient</option>
            <option value="ADMIN">Administrateur</option>
          </select>
        </div>
      </div>
      <div class="card-body-medical">
        <div class="users-table-section">
          <table class="users-table-medical">
            <thead>
              <tr>
                <th>Nom</th>
                <th>Prénom</th>
                <th>Email</th>
                <th>Téléphone</th>
                <th>Rôle</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of filteredUsers">
                <td>{{ user.nom }}</td>
                <td>{{ user.prenom }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.telephone }}</td>
                <td>
                  <span class="role-badge-medical" [ngClass]="'role-' + user.role">
                    {{ getRoleLabel(user.role) }}
                  </span>
                </td>
                <td class="actions">
                  <button class="btn btn-sm btn-edit" (click)="editUser(user)">
                    Modifier
                  </button>
                  <button class="btn btn-sm btn-delete" (click)="deleteUser(user)">
                    Supprimer
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="filteredUsers.length === 0" class="no-users">
            Aucun utilisateur trouvé
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="showForm" class="card-medical mb-4">
      <div class="card-header-medical">
        <h5 class="card-title">
          <i class="fas fa-user-plus me-2"></i>{{ isAddMode ? 'Ajouter un nouvel utilisateur' : 'Modifier l\'utilisateur' }}
        </h5>
      </div>
      <div class="card-body-medical">
        <form [formGroup]="userForm" (ngSubmit)="saveUser()">
          <div class="form-grid-medical">
            <div class="form-group-medical">
              <label class="form-label-medical">Nom</label>
              <input type="text" formControlName="nom" placeholder="Entrez le nom" class="form-input-medical" />
            </div>
            <div class="form-group-medical">
              <label class="form-label-medical">Prénom</label>
              <input type="text" formControlName="prenom" placeholder="Entrez le prénom" class="form-input-medical" />
            </div>
            <div class="form-group-medical">
              <label class="form-label-medical">Email</label>
              <input type="email" formControlName="email" placeholder="Entrez l'email" class="form-input-medical" />
            </div>
            <div class="form-group-medical">
              <label class="form-label-medical">Téléphone</label>
              <input type="tel" formControlName="telephone" placeholder="Entrez le téléphone" class="form-input-medical" />
            </div>
            <div class="form-group-medical">
              <label class="form-label-medical">Rôle</label>
              <select formControlName="role" class="form-input-medical">
                <option value="">Sélectionnez un rôle</option>
                <option value="COACH">Coach</option>
                <option value="USER">Patient</option>
                <option value="ADMIN">Administrateur</option>
              </select>
            </div>
            <div *ngIf="isAddMode" class="form-group-medical">
              <label class="form-label-medical">Mot de passe</label>
              <input type="password" formControlName="psw" placeholder="Entrez le mot de passe" class="form-input-medical" />
            </div>
          </div>
          <div class="form-actions-medical">
            <button type="submit" class="btn btn-success">
              {{ isAddMode ? 'Créer' : 'Modifier' }}
            </button>
            <button type="button" class="btn btn-secondary" (click)="cancelForm()">
              Annuler
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

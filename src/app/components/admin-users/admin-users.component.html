<div class="admin-users-container">
  <div class="admin-header">
    <h1>Gestion des Utilisateurs</h1>
    <p class="subtitle">L'administrateur de l'application peut gérer des utilisateurs (coach et patients)</p>
  </div>

  <!-- Messages de succès et d'erreur -->
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <!-- Barre d'outils -->
  <div class="toolbar">
    <button class="btn btn-primary" (click)="addUser()">
      + Ajouter un utilisateur
    </button>
  </div>

  <!-- Filtres et recherche -->
  <div class="filters-section">
    <div class="search-box">
      <input
        type="text"
        placeholder="Rechercher par nom, prénom ou email..."
        [(ngModel)]="searchQuery"
        (input)="onSearchChange()"
      />
    </div>
    <div class="filter-box">
      <select [(ngModel)]="filterRole" (change)="onFilterChange()">
        <option value="">Tous les rôles</option>
        <option value="COACH">Coach</option>
        <option value="USER">Patient</option>
        <option value="admin">Administrateur</option>
      </select>
    </div>
  </div>

  <!-- Formulaire d'ajout/modification -->
  <div *ngIf="showForm" class="form-section">
    <div class="form-card">
      <h2>{{ isAddMode ? 'Ajouter un nouvel utilisateur' : 'Modifier l\'utilisateur' }}</h2>
      <form [formGroup]="userForm" (ngSubmit)="saveUser()">
        <div class="form-group">
          <label>Nom</label>
          <input
            type="text"
            formControlName="nom"
            placeholder="Entrez le nom"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label>Prénom</label>
          <input
            type="text"
            formControlName="prenom"
            placeholder="Entrez le prénom"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label>Email</label>
          <input
            type="email"
            formControlName="email"
            placeholder="Entrez l'email"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label>Téléphone</label>
          <input
            type="tel"
            formControlName="telephone"
            placeholder="Entrez le téléphone"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label>Rôle</label>
          <select formControlName="role" class="form-control">
            <option value="">Sélectionnez un rôle</option>
            <option value="COACH">Coach</option>
            <option value="USER">Patient</option>
            <option value="admin">Administrateur</option>
          </select>
        </div>

        <div *ngIf="isAddMode" class="form-group">
          <label>Mot de passe</label>
          <input
            type="password"
            formControlName="psw"
            placeholder="Entrez le mot de passe"
            class="form-control"
          />
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-success">
            {{ isAddMode ? 'Créer' : 'Modifier' }}
          </button>
          <button type="button" class="btn btn-secondary" (click)="cancelForm()">
            Annuler
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Tableau des utilisateurs -->
  <div class="users-table-section">
    <table class="users-table">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Prénom</th>
          <th>Email</th>
          <th>Téléphone</th>
          <th>Rôle</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of filteredUsers">
          <td>{{ user.nom }}</td>
          <td>{{ user.prenom }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.telephone }}</td>
          <td>
            <span class="role-badge" [ngClass]="'role-' + user.role">
              {{ getRoleLabel(user.role) }}
            </span>
          </td>
          <td class="actions">
            <button class="btn btn-sm btn-edit" (click)="editUser(user)">
              Modifier
            </button>
            <button class="btn btn-sm btn-delete" (click)="deleteUser(user)">
              Supprimer
            </button>
          </td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="filteredUsers.length === 0" class="no-users">
      Aucun utilisateur trouvé
    </div>
  </div>
</div>

<div class="container mt-5 mb-5 pt-4">
  <div class="card shadow">
    <div class="card-header bg-primary text-white">
      <h3 class="mb-0">Évaluation de l'Humeur</h3>
    </div>
    
    <div class="card-body">
      <form [formGroup]="evaluationForm" (ngSubmit)="onSubmit()">

        <!-- Indicateurs (1-10) -->
        <h5 class="text-primary border-bottom pb-2 mb-3">Indicateurs (1-10)</h5>
        <div class="row g-3">
          <div class="col-md-6" *ngFor="let metric of ['humeur', 'stress', 'energie', 'motivation', 'sommeil']">
            <label class="form-label text-capitalize fw-bold">
              {{ metric }} : <span class="badge bg-info">{{ evaluationForm.get(metric)?.value }}</span>
            </label>
            <input type="range" class="form-range" min="1" max="10" [formControlName]="metric">
            <div class="d-flex justify-content-between text-muted small">
              <span>1 (Faible)</span>
              <span>10 (Fort)</span>
            </div>
          </div>
        </div>

        <!-- État Physique & Social -->
        <h5 class="text-primary border-bottom pb-2 mb-3 mt-4">État Physique & Social</h5>
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label fw-bold">Appétit</label>
            <select class="form-select" formControlName="appetit">
              <option *ngFor="let opt of appetitOptions" [value]="opt">{{ opt }}</option>
            </select>
          </div>
          
          <div class="col-md-4">
            <label class="form-label fw-bold">Activité Physique</label>
            <select class="form-select" formControlName="activite_physique">
              <option *ngFor="let opt of activiteOptions" [value]="opt">{{ opt }}</option>
            </select>
          </div>

          <div class="col-md-4">
            <label class="form-label fw-bold">Social</label>
            <select class="form-select" formControlName="interactions_sociales">
              <option *ngFor="let opt of socialOptions" [value]="opt">{{ opt }}</option>
            </select>
          </div>
        </div>

        <!-- Pensées à risque -->
        <div class="alert alert-warning mt-4">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="riskSwitch" formControlName="pensees_risque">
            <label class="form-check-label fw-bold text-danger" for="riskSwitch">
              Présence de pensées à risque ?
            </label>
          </div>

          <div *ngIf="evaluationForm.get('pensees_risque')?.value" class="mt-3">
            <label class="form-label text-danger">Détails (Obligatoire)</label>
            <textarea class="form-control border-danger" rows="3" formControlName="details_risque" placeholder="Décrivez les pensées..."></textarea>
          </div>
        </div>

        <!-- Symptômes et Commentaire -->
        <div class="mt-3">
          <label class="form-label fw-bold">Symptômes</label>
          <textarea class="form-control" rows="2" formControlName="symptomes" placeholder="Douleurs, anxiété..."></textarea>
        </div>

        <div class="mt-3">
          <label class="form-label fw-bold">Commentaire</label>
          <textarea class="form-control" rows="2" formControlName="commentaire"></textarea>
        </div>

        <!-- Boutons -->
        <div class="d-flex gap-2 mt-4">
          <button type="submit" class="btn btn-primary btn-lg" [disabled]="evaluationForm.invalid">
            Enregistrer
          </button>

          <!-- Nouveau bouton pour afficher le graphe -->
          <button type="button" class="btn btn-success btn-lg" (click)="afficherGraphe()">
            Voir le graphe
          </button>
        </div>

      </form>

      <!-- Graphe Chart.js -->
      <div *ngIf="showGraph" class="mt-5">
        <h5 class="text-primary mb-3">Graphique des évaluations</h5>
        <canvas id="evaluationGraph"></canvas>
      </div>
    </div>
  </div>
</div>

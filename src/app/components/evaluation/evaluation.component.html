<div class="prescription-container">
  <div class="container mt-4">
    

    <div class="page-header-section evaluation-header mb-4">
      <div class="header-content">
        <div class="medical-icon evaluation">
          <i class="fas fa-clipboard-check"></i>
        </div>
        <div class="header-text">
          <h1 class="main-title">Évaluation de l'Humeur</h1>
          <p class="subtitle">Suivi quotidien de votre état de santé</p>
        </div>
      </div>
    </div>


    <div class="evaluation-form-container">
      <form [formGroup]="evaluationForm" (ngSubmit)="onSubmit()">


        <div class="card-medical mb-4">
          <div class="card-header-medical">
            <h5 class="card-title">
              <i class="fas fa-chart-line me-2"></i>Indicateurs de Bien-être (1-10)
            </h5>
          </div>
          <div class="card-body-medical">
            <div class="metrics-grid">
              <div class="metric-slider" *ngFor="let metric of ['humeur', 'stress', 'energie', 'motivation', 'sommeil']">
                <div class="metric-header">
                  <label class="metric-label">
                    <i [class]="getMetricIcon(metric)" class="me-2"></i>
                    {{ getMetricLabel(metric) }}
                  </label>
                  <span class="metric-value">{{ evaluationForm.get(metric)?.value }}/10</span>
                </div>
                <input type="range" class="form-range-medical" min="1" max="10" [formControlName]="metric">
                <div class="metric-scale">
                  <span class="scale-min">1 (Faible)</span>
                  <span class="scale-max">10 (Fort)</span>
                </div>
              </div>
            </div>
          </div>
        </div>


        <div class="card-medical mb-4">
          <div class="card-header-medical">
            <h5 class="card-title">
              <i class="fas fa-heartbeat me-2"></i>État Physique & Social
            </h5>
          </div>
          <div class="card-body-medical">
            <div class="state-grid">
              <div class="state-item">
                <div class="state-icon appetite">
                  <i class="fas fa-utensils"></i>
                </div>
                <div class="state-content">
                  <label class="state-label">Appétit</label>
                  <select class="form-select-medical" formControlName="appetit">
                    <option *ngFor="let opt of appetitOptions" [value]="opt">{{ opt }}</option>
                  </select>
                </div>
              </div>

              <div class="state-item">
                <div class="state-icon activity">
                  <i class="fas fa-running"></i>
                </div>
                <div class="state-content">
                  <label class="state-label">Activité Physique</label>
                  <select class="form-select-medical" formControlName="activite_physique">
                    <option *ngFor="let opt of activiteOptions" [value]="opt">{{ opt }}</option>
                  </select>
                </div>
              </div>

              <div class="state-item">
                <div class="state-icon social">
                  <i class="fas fa-users"></i>
                </div>
                <div class="state-content">
                  <label class="state-label">Interactions Sociales</label>
                  <select class="form-select-medical" formControlName="interactions_sociales">
                    <option *ngFor="let opt of socialOptions" [value]="opt">{{ opt }}</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>


        <div class="card-medical mb-4">
          <div class="card-header-medical warning">
            <h5 class="card-title">
              <i class="fas fa-exclamation-triangle me-2"></i>Évaluation des Risques
            </h5>
          </div>
          <div class="card-body-medical">
            <div class="risk-assessment">
              <div class="risk-toggle">
                <div class="form-check-medical">
                  <input class="form-check-input-medical" type="checkbox" id="riskSwitch" formControlName="pensees_risque">
                  <label class="form-check-label-medical" for="riskSwitch">
                    <i class="fas fa-shield-alt me-2"></i>
                    Présence de pensées à risque ?
                  </label>
                </div>
              </div>

              <div *ngIf="evaluationForm.get('pensees_risque')?.value" class="risk-details">
                <div class="risk-details-content">
                  <label class="risk-label">
                    <i class="fas fa-notes-medical me-2"></i>
                    Détails (Obligatoire)
                  </label>
                  <textarea class="form-input-medical risk-textarea" rows="3" 
                            formControlName="details_risque" 
                            placeholder="Veuillez décrire les pensées ou préoccupations..."></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>


        <div class="card-medical mb-4">
          <div class="card-header-medical">
            <h5 class="card-title">
              <i class="fas fa-sticky-note me-2"></i>Informations Complémentaires
            </h5>
          </div>
          <div class="card-body-medical">
            <div class="additional-info-grid">
              <div class="info-item">
                <label class="info-label">
                  <i class="fas fa-thermometer-half me-2"></i>
                  Symptômes
                </label>
                <textarea class="form-input-medical" rows="2" 
                          formControlName="symptomes" 
                          placeholder="Décrivez vos symptômes (douleurs, anxiété, fatigue...)"></textarea>
              </div>

              <div class="info-item">
                <label class="info-label">
                  <i class="fas fa-comment-dots me-2"></i>
                  Commentaire Général
                </label>
                <textarea class="form-input-medical" rows="2" 
                          formControlName="commentaire"
                          placeholder="Partagez vos observations ou préoccupations..."></textarea>
              </div>
            </div>
          </div>
        </div>


        <div class="action-section-medical">
          <div class="action-buttons">
            <button type="submit" class="btn-medical btn-primary" [disabled]="evaluationForm.invalid">
              <i class="fas fa-save me-2"></i>
              Enregistrer l'Évaluation
            </button>

            <button type="button" class="btn-medical btn-success" (click)="afficherGraphe()">
              <i class="fas fa-chart-bar me-2"></i>
              Voir le Graphique
            </button>

            <button type="button" class="btn-medical btn-outline" (click)="resetForm()">
              <i class="fas fa-redo me-2"></i>
              Réinitialiser
            </button>
          </div>
        </div>

      </form>

      <div *ngIf="showGraph" class="card-medical mt-4">
        <div class="card-header-medical">
          <h5 class="card-title">
            <i class="fas fa-chart-line me-2"></i>Évolution des Évaluations
          </h5>
        </div>
        <div class="card-body-medical">
          <div class="graph-container">
            <canvas id="evaluationGraph"></canvas>
          </div>
          <div class="graph-legend">
            <div class="legend-item" *ngFor="let item of graphLegend">
              <span class="legend-color" [style.background]="item.color"></span>
              <span class="legend-text">{{ item.label }}</span>
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>
</div>